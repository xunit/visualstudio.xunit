<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- Handle the coexistance between testing platform and Microsoft.NET.Test.Sdk  -->
  <PropertyGroup>
    <GenerateTestingPlatformEntryPoint Condition=" '$(GenerateTestingPlatformEntryPoint)' == '' ">$(EnableXunitRunner)</GenerateTestingPlatformEntryPoint>
    <GenerateProgramFile Condition=" '$(EnableXunitRunner)' == 'true' ">false</GenerateProgramFile>
    <DisableTestingPlatformServerCapability Condition=" '$(EnableXunitRunner)' != 'true' " >true</DisableTestingPlatformServerCapability>
  </PropertyGroup>

  <Choose>
    <!-- Avoid false warning about missing reference (msbuild bug) -->
    <!-- https://github.com/dotnet/msbuild/issues/9698#issuecomment-1945763467 -->
    <When Condition=" '$(EnableXunitRunner)' == 'true' ">
      <ItemGroup>
        <Reference Include="xunit.runner.visualstudio.testadapter">
          <HintPath>$(MSBuildThisFileDirectory)xunit.runner.visualstudio.testadapter.dll</HintPath>
        </Reference>
      </ItemGroup>
    </When>
    <Otherwise>
      <ItemGroup>
        <None Include="$(MSBuildThisFileDirectory)xunit.runner.visualstudio.testadapter.dll">
          <Link>xunit.runner.visualstudio.testadapter.dll</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
          <Visible>False</Visible>
        </None>
      </ItemGroup>
    </Otherwise>
  </Choose>

</Project>
